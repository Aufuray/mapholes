<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>GIS Term Project | Group 6</title>
  <style type="text/css">
  html, body, #map
  {
      height: 99%;
      margin: 0px;
      padding: 0px;
  }
  </style>
    	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
        <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
	</head>

	<body onload="initMap();">
    <div id="map">
    </div>


  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
     <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDhV1yHFyxci_wmV6BB4X-qboGt9NnVFGU&libraries=drawing"></script>

  <script>
    	var map; //the google map element
        var directionDisplay;
        var directionsService = new google.maps.DirectionsService();

        function initMap() {
            var mapOptions = {
                center: new google.maps.LatLng(40.604050, -74.000557), 
                zoom:13,
                styles:[
                {
                    "featureType": "administrative",
                    "elementType": "labels.text.fill",
                    "stylers": [ { "color": "#00ee00" },{"visibility": "off"}]
                },
                {
                    "featureType": "administrative.country",
                    "elementType": "geometry",
                    "stylers": [{"visibility": "off"}]
                },
                {
                    "featureType": "administrative.country",
                    "elementType": "geometry.stroke",
                    "stylers": [{"visibility": "on"}]
                },
                {
                    "featureType": "administrative.country",
                    "elementType": "labels.text",
                    "stylers": [ {"hue": "#fff600"}]
                },
                {
                    "featureType": "landscape",
                    "elementType": "all"
                },
                {
                    "featureType": "poi",
                    "elementType": "all",
                    "stylers": [
                    {"visibility": "off"}]
                },
                {
                    "featureType": "road",
                    "elementType": "all",
                    "stylers": [{"saturation": -100},{"lightness": 45}]
                },
                {
                    "featureType": "road.highway",
                    "elementType": "all",
                    "stylers": [ { "visibility": "off"}]
                },
                {
                    "featureType": "road.arterial",
                    "elementType": "labels.icon",
                    "stylers": [{"visibility": "off"}]
                },
                {
                    "featureType": "transit",
                    "elementType": "all",
                    "stylers": [{"visibility": "off"}]
                },
                {
                    "featureType": "water",
                    "elementType": "all",
                    "stylers": [{"visibility": "on"}]
                }
                ]
            }

             
            directionsDisplay = new google.maps.DirectionsRenderer({
                suppressMarkers: true
            });

            map = new google.maps.Map(document.getElementById('map'), mapOptions);
            directionsDisplay.setMap(map);


        // Create a <script> tag and set the USGS URL as the source.
        var script = document.createElement('script');
        script.src = 'https://cdn.rawgit.com/mapholes/mapholes.github.io/master/data/manholes_geojson.js';
        document.getElementsByTagName('head')[0].appendChild(script);
        }

        function createMarker(latlng, iconForLocation) {
            var marker = new google.maps.Marker({
            position: latlng,
            icon: iconForLocation,
            map: map
        });
        }


        // Loop through the results array and place a marker for each
      // set of coordinates.
      window.eqfeed_callback = function(results) {

        var iconBase = 'https://raw.githubusercontent.com/mapholes/mapholes.github.io/master/img/';
            var icons = {
              high_priority: {
                icon: iconBase + 'high_priority.png'
              },
              medium_priority: {
                icon: iconBase + 'medium_priority.png'
              },
              low_priority: {
                icon: iconBase + 'low_priority.png'
              },
              company: {
                icon: iconBase + 'companyIcon.png'
              }
            };

         var start, end;
         var waypts = [];

        for (var i = 0; i < results.features.length && i < 20; i++) {

          var coords = results.features[i].geometry.coordinates;
          var latLng = new google.maps.LatLng(coords[1],coords[0]);

          var iconForLocation;

          if (results.features[i].properties.status == 'Open'){
             iconForLocation = icons['high_priority'].icon;
             waypts.push({
                location: latLng,
                stopover: true
             });
          }

          else if (results.features[i].properties.status == 'Company'){
            iconForLocation = icons['company'].icon;
            start = latLng;
            end = latLng;
          }
           
          else{
            iconForLocation = icons['low_priority'].icon;
            waypts.push({
                location: latLng,
                stopover: true
             });
          }
           createMarker(latLng, iconForLocation)

      }
    var request = {
        origin: start,
        destination: end,
        waypoints: waypts,
        optimizeWaypoints: true,
        travelMode: google.maps.DirectionsTravelMode.WALKING
    };

    directionsService.route(request, function (response, status) {
        if (status == google.maps.DirectionsStatus.OK) {
            directionsDisplay.setDirections(response);
            var route = response.routes[0].legs[0];
            $( '#travel_data' ).html( 'Estimated travel time: ' + route.duration.text + ' (' + route.distance.text + ')' );
        }
    });
  }

      // DrawingManager GUI for us to draw polygons, rectangles, polylines, circles, and markers on the map.

      // var drawingManager = new google.maps.drawing.DrawingManager();
      //   drawingManager.setMap(map);

        </script>


	</body>
  </script>
  
</head>

<body onload="initMap();">
  <div id="map" style="height=300px; float:left;"></div>
  <div id="travel_data">T</div>
</body>
</html>
